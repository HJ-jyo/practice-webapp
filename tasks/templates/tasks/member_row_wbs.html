<div class="m-card" onclick="openProfileModal(this)"
     data-id="{{ assign.user.id }}"
     data-username="{{ assign.user.username }}"
     data-bio="{{ assign.user.profile.bio|default:'' }}"
     data-icon="{% if assign.user.profile.icon %}{{ assign.user.profile.icon.url }}{% endif %}">
     
    <div class="m-avatar">
        {% if assign.user.profile.icon %}
            <img src="{{ assign.user.profile.icon.url }}">
        {% else %}
            {{ assign.user.username|slice:":1" }}
        {% endif %}
    </div>
    
    <div class="m-info">
        <div style="display:flex; align-items:center;">
            <div class="m-name" style="{% if assign.user == request.user %}color:#3b82f6;{% endif %}">
                {{ assign.user.username }}
            </div>
            
            {% if assign.role_name %}
                <span class="role-badge">{{ assign.role_name }}</span>
            {% endif %}
        </div>

        {% if is_owner %}
        <div style="margin-top:4px;" onclick="event.stopPropagation()">
            <input type="text" class="role-input" placeholder="ロール付与" 
                   value="{{ assign.role_name|default:'' }}"
                   onchange="saveRole({{ assign.id }}, this)">
        </div>
        {% endif %}

        <div style="font-size:10px; color:#94a3b8; margin-top:2px;">
            <i class="bi bi-calendar-check"></i> {{ assign.joined_at|date:"Y/m/d" }} 開始
        </div>
        
        <div class="member-progress-bar">
            {% if assign.status == 'todo' %}
                <div class="mp-fill" style="width: 5%; background: #cbd5e1;"></div>
            {% elif assign.status == 'doing' %}
                <div class="mp-fill" style="width: 50%; background: #f59e0b;"></div>
            {% elif assign.status == 'done' %}
                <div class="mp-fill" style="width: 100%; background: #10b981;"></div>
            {% endif %}
        </div>
    </div>
</div>