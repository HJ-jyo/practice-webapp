<div class="task-card">
    <div class="d-flex justify-content-between align-items-start mb-2">
        {% if task.category %}
            <span class="task-tag">{{ task.category.name }}</span>
        {% else %}
            <span></span>
        {% endif %}
        
        <a href="{% url 'task_edit' task.pk %}" style="color:var(--text-sub); font-size:0.9rem;">
            <i class="bi bi-pencil-square"></i>
        </a>
    </div>
    
    <div class="task-title">{{ task.title }}</div>
    
    <div class="task-meta">
        <span><i class="bi bi-clock"></i> {{ task.due_date|date:"m/d H:i"|default:"期限なし" }}</span>
        
        {% if not is_done %}
            <div style="display:flex; gap:5px;">
                {% if status_color == 'todo' %}
                    <form action="{% url 'move_to_doing' task.pk %}" method="post">{% csrf_token %}
                        <button type="submit" style="border:none; background:var(--doing-bg); color:var(--doing-text); border-radius:4px; padding:2px 6px; font-size:0.7rem; cursor:pointer; font-weight:bold;">
                            開始 <i class="bi bi-arrow-right"></i>
                        </button>
                    </form>
                {% elif status_color == 'doing' %}
                    <form action="{% url 'move_to_done' task.pk %}" method="post">{% csrf_token %}
                        <button type="submit" style="border:none; background:var(--done-bg); color:var(--done-text); border-radius:4px; padding:2px 6px; font-size:0.7rem; cursor:pointer; font-weight:bold;">
                            完了 <i class="bi bi-check"></i>
                        </button>
                    </form>
                {% endif %}
            </div>
        {% else %}
             <span style="color:var(--done-text); font-weight:bold;"><i class="bi bi-check2-all"></i> Done</span>
        {% endif %}
    </div>
</div>