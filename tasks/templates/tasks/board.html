{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="header-bar">
    <div>
        <h1 class="page-title">ダッシュボード</h1>
        <p style="color:var(--text-sub); font-size:0.9rem; margin-top:5px;">
            <i class="bi bi-calendar-event"></i> 今日: {{ now|date:"Y年n月j日" }}
        </p>
    </div>

    <form method="get" style="display:flex; gap:10px;">
        <input type="text" name="q" class="form-control" placeholder="タスクを検索..." value="{{ query|default:'' }}" style="width:250px;">
        {% if query %}
            <a href="{% url 'board' %}" class="btn-primary" style="background:var(--text-sub); display:flex; align-items:center;">クリア</a>
        {% else %}
            <button type="submit" class="btn-primary"><i class="bi bi-search"></i></button>
        {% endif %}
    </form>
</div>

<div class="kanban-grid">
    
    <div class="kanban-col">
        <div class="col-header" style="color:var(--todo-text); border-color:var(--todo-bg);">
            <span><i class="bi bi-circle"></i> 未着手</span>
            <span style="background:var(--todo-bg); padding:2px 8px; border-radius:10px; font-size:0.8rem;">
                {{ tasks_todo.count }}
            </span>
        </div>
        <div class="task-list">
            {% for task in tasks_todo %}
                {% include "tasks/card_snippet.html" with task=task status_color="todo" %}
            {% empty %}
                <div style="text-align:center; color:var(--text-sub); margin-top:20px; font-size:0.85rem;">タスクなし</div>
            {% endfor %}
        </div>
    </div>

    <div class="kanban-col">
        <div class="col-header" style="color:var(--doing-text); border-color:var(--doing-bg);">
            <span><i class="bi bi-play-circle"></i> 進行中</span>
            <span style="background:var(--doing-bg); padding:2px 8px; border-radius:10px; font-size:0.8rem;">
                {{ tasks_doing.count }}
            </span>
        </div>
        <div class="task-list">
            {% for task in tasks_doing %}
                {% include "tasks/card_snippet.html" with task=task status_color="doing" %}
            {% empty %}
                <div style="text-align:center; color:var(--text-sub); margin-top:20px; font-size:0.85rem;">タスクなし</div>
            {% endfor %}
        </div>
    </div>

    <div class="kanban-col">
        <div class="col-header" style="color:var(--done-text); border-color:var(--done-bg);">
            <span><i class="bi bi-check-circle"></i> 完了</span>
            <div style="display:flex; gap:10px; align-items:center;">
                <span style="background:var(--done-bg); padding:2px 8px; border-radius:10px; font-size:0.8rem;">
                    {{ tasks_done.count }}
                </span>
                {% if tasks_done.count > 0 %}
                <form action="{% url 'delete_done_tasks' %}" method="post" onsubmit="return confirm('完了タスクを全て削除しますか？');">
                    {% csrf_token %}
                    <button type="submit" style="border:none; background:none; color:var(--text-sub); cursor:pointer;">
                        <i class="bi bi-trash"></i>
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        <div class="task-list">
            {% for task in tasks_done %}
                {% include "tasks/card_snippet.html" with task=task status_color="done" is_done=True %}
            {% empty %}
                <div style="text-align:center; color:var(--text-sub); margin-top:20px; font-size:0.85rem;">完了タスクなし</div>
            {% endfor %}
        </div>
    </div>

</div>
{% endblock %}