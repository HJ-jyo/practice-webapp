{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Workspace</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="p-workspace">
        
        <header class="p-global-nav">
            <div style="flex:1;"></div> <form action="{% url 'board' %}" method="get" class="p-search-box">
                <i class="bi bi-search"></i>
                <input type="text" name="q" placeholder="タスクを検索..." value="{{ request.GET.q|default:'' }}">
            </form>
            
            <div style="flex:1; display:flex; justify-content:flex-end;">
                <i class="bi bi-question-circle" style="opacity:0.7;"></i>
            </div>
        </header>

        <aside class="p-sidebar">
            <div class="p-sidebar-header">
                <span>Kanban Project</span>
                <i class="bi bi-chevron-down" style="font-size:12px;"></i>
            </div>

            <div class="p-sidebar-section">
                <a href="{% url 'board' %}" class="p-channel-item {% if request.resolver_match.url_name == 'board' %}active{% endif %}">
                    <span class="p-channel-icon">#</span> ボード
                </a>
                <a href="{% url 'task_create' %}" class="p-channel-item {% if request.resolver_match.url_name == 'task_create' %}active{% endif %}">
                    <span class="p-channel-icon"><i class="bi bi-plus-lg"></i></span> 新規タスク
                </a>
                
                <div style="margin-top:20px; padding-left:16px; font-size:13px; font-weight:bold; color:var(--slack-text-gray);">
                    ダイレクトメッセージ
                </div>
                <a href="{% url 'invitation_list' %}" class="p-channel-item {% if request.resolver_match.url_name == 'invitation_list' %}active{% endif %}">
                    <span class="p-channel-icon"><i class="bi bi-chat-left-text"></i></span> 通知 / 招待
                </a>
            </div>

            {% if user.is_authenticated %}
            <div class="p-sidebar-user" onclick="location.href='{% url 'profile' %}'">
                <div class="c-avatar">{{ user.username|slice:":1" }}</div>
                <div style="flex-grow:1; font-weight:bold; font-size:14px; color:white;">
                    {{ user.username }}
                    <span style="display:inline-block; width:8px; height:8px; background:#2EB67D; border-radius:50%; margin-left:4px;"></span>
                </div>
                
                <form action="{% url 'logout' %}" method="post" style="margin:0;" onclick="event.stopPropagation();">
                    {% csrf_token %}
                    <button type="submit" style="background:none; border:none; color:var(--slack-text-gray); cursor:pointer;" title="ログアウト">
                        <i class="bi bi-box-arrow-right"></i>
                    </button>
                </form>
            </div>
            {% endif %}
        </aside>

        <main class="p-client-view">
            {% block content %}{% endblock %}
        </main>
    </div>
</body>
</html>